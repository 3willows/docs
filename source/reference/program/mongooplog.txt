.. _mongooplog:

==============
``mongooplog``
==============

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol
.. |tool-binary| replace:: mongooplog

.. versionadded:: 2.2

Synopsis
--------

:binary:`~bin.mongooplog` is a simple tool that polls operations from
the :term:`replication` :term:`oplog` of a remote server, and applies
them to the local server. This capability supports certain classes of
real-time migrations that require that the source server remain online
and in operation throughout the migration process.

Typically this command will take the following form:

.. code-block:: sh

   mongooplog  --from mongodb0.example.net --host mongodb1.example.net

This command copies oplog entries from the :binary:`~bin.mongod` instance
running on the host ``mongodb0.example.net`` and duplicates
operations to the host ``mongodb1.example.net``. If you do not need
to keep the :option:`--from <mongooplog --from>` host running during
the migration, consider using :binary:`~bin.mongodump` and
:binary:`~bin.mongorestore` or another :doc:`backup
</core/backups>` operation, which may be better suited to
your operation.

.. note::

   If the :binary:`~bin.mongod` instance specified by the :option:`--from <mongooplog --from>`
   argument is running with :setting:`authentication <auth>`, then
   :binary:`~bin.mongooplog` will not be able to copy oplog entries.

.. seealso:: :binary:`~bin.mongodump`, :binary:`~bin.mongorestore`,
   :doc:`/core/backups`, :doc:`/core/replica-set-oplog`.

Options
-------

.. binary:: mongooplog

.. program:: mongooplog

.. option:: --help

   Returns information on the options and use of :program:`mongooplog`.


.. option:: --verbose, -v

   Increases the amount of internal reporting returned on standard output
   or in log files. Increase the verbosity with the ``-v`` form by
   including the option multiple times, (e.g. ``-vvvvv``.)
   


.. option:: --quiet

   Runs the :program:`mongooplog` in a quiet mode that attempts to limit the amount
   of output.

   This option suppresses:
   
   - connection accepted events
   
   - connection closed events
   


.. option:: --version

   Returns the :program:`mongooplog` release number.


.. option:: --host <hostname><:port>, -h <hostname><:port>

   Specifies a resolvable hostname for the :binary:`~bin.mongod` instance to
   which :binary:`~bin.mongooplog` will apply :term:`oplog` operations
   retrieved from the server specified by the :option:`--from <mongooplog
   --from>` option.
   
   By default :program:`mongooplog` attempts to connect to a MongoDB instance running
   on the localhost on port number ``27017``.
   
   To connect to a replica set, specify the :setting:`replica set name
   <~replication.replSetName>` and a seed list of set members. Use the
   following form:
   
   .. code-block:: none
   
      <replSetName>/<hostname1><:port>,<hostname2><:port>,<...>
   
   You can always connect directly to a single MongoDB instance by
   specifying the host and port number directly.


.. option:: --port

   Specifies the port number of the :binary:`~bin.mongod` instance where
   :binary:`~bin.mongooplog` will apply :term:`oplog` entries. Specify
   this option only if the MongoDB instance to connect to is not
   running on the standard port of ``27017``. You may also specify a
   port number using the :option:`--host <mongooplog --host>` command.
   


.. option:: --ipv6

   Enables IPv6 support and allows the :program:`mongooplog` to connect to the
   MongoDB instance using an IPv6 network. All MongoDB programs and
   processes disable IPv6 support by default.


.. option:: --ssl

   .. versionadded:: 2.6
   
   Enables connection to a :binary:`~bin.mongod` or :binary:`~bin.mongos` that has
   TLS/SSL support enabled.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.
   


.. option:: --sslCAFile <filename>

   .. versionadded:: 2.6
   
   Specifies the :file:`.pem` file that contains the root certificate chain
   from the Certificate Authority. Specify the file name of the
   :file:`.pem` file using relative or absolute paths.
   
   The default distribution of MongoDB does not contain support for
   TLS/SSL. For more information on MongoDB and TLS/SSL, see
   :doc:`/tutorial/configure-ssl`.
   
   .. include:: /includes/warning-always-use-sslCAFile-for-mongo.rst
   


.. option:: --sslPEMKeyFile <filename>

   .. versionadded:: 2.6
   
   Specifies the :file:`.pem` file that contains both the TLS/SSL certificate
   and key. Specify the file name of the :file:`.pem` file using relative
   or absolute paths.
   
   This option is required when using the :option:`--ssl` option to connect
   to a :binary:`~bin.mongod` or :binary:`~bin.mongos` that has
   :setting:`~net.ssl.CAFile` enabled *without*
   :setting:`~net.ssl.weakCertificateValidation`.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.
   


.. option:: --sslPEMKeyPassword <value>

   .. versionadded:: 2.6
   
   Specifies the password to de-crypt the certificate-key file (i.e.
   :option:`--sslPEMKeyFile`). Use the :option:`--sslPEMKeyPassword` option only if the
   certificate-key file is encrypted. In all cases, the :program:`mongooplog` will
   redact the password from all logging and reporting output.
   
   If the private key in the PEM file is encrypted and you do not specify
   the :option:`--sslPEMKeyPassword` option, the :program:`mongooplog` will prompt for a passphrase. See
   :ref:`ssl-certificate-password`.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.


.. option:: --sslCRLFile <filename>

   .. versionadded:: 2.6
   
   Specifies the :file:`.pem` file that contains the Certificate Revocation
   List. Specify the file name of the :file:`.pem` file using relative or
   absolute paths.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.
   


.. option:: --sslAllowInvalidCertificates

   .. versionadded:: 2.6
   
   Bypasses the validation checks for server certificates and allows
   the use of invalid certificates. When using the
   :setting:`~net.ssl.allowInvalidCertificates` setting, MongoDB logs as a
   warning the use of the invalid certificate.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.
   


.. option:: --sslFIPSMode

   .. versionadded:: 2.6
   
   Directs the :program:`mongooplog` to use the FIPS mode of the installed OpenSSL
   library. Your system must have a FIPS compliant OpenSSL library to use
   the :option:`--sslFIPSMode` option.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.


.. option:: --username <username>, -u <username>

   Specifies a username with which to authenticate to a MongoDB database
   that uses authentication. Use in conjunction with the ``--password`` and
   ``--authenticationDatabase`` options.
   


.. option:: --password <password>, -p <password>

   Specifies a password with which to authenticate to a MongoDB database
   that uses authentication. Use in conjunction with the ``--username`` and
   ``--authenticationDatabase`` options.
   
   If you do not specify an argument for :option:`--password`, :program:`mongooplog` will
   prompt interactively for a password on the console.


.. option:: --authenticationDatabase <dbname>

   .. versionadded:: 2.4
   
   Specifies the database that holds the user's credentials.   
   


.. option:: --authenticationMechanism <name>

   *Default*: MONGODB-CR

   .. versionadded:: 2.4
   
   .. versionchanged:: 2.6
      Added support for the ``PLAIN`` and ``MONGODB-X509`` authentication
      mechanisms.
   
   Specifies the authentication mechanism the :program:`mongooplog` instance uses to
   authenticate to the :binary:`~bin.mongod` or :binary:`~bin.mongos`.
   
   .. list-table::
      :header-rows: 1
      :widths: 20 40
   
      * - Value
   
        - Description
   
      * - MONGODB-CR
   
        - MongoDB challenge/response authentication.
   
      * - MONGODB-X509
   
        - MongoDB TLS/SSL certificate authentication.
   
      * - PLAIN
   
        - External authentication using LDAP. You can also use ``PLAIN``
          for authenticating in-database users. ``PLAIN`` transmits
          passwords in plain text. This mechanism is available only in
          `MongoDB Enterprise
          <http://www.mongodb.com/products/mongodb-enterprise>`_.
   
      * - GSSAPI
   
        - External authentication using Kerberos. This mechanism is
          available only in `MongoDB Enterprise
          <http://www.mongodb.com/products/mongodb-enterprise>`_.


.. option:: --gssapiServiceName

   .. versionadded:: 2.6
   
   Specify the name of the service using :doc:`GSSAPI/Kerberos
   </core/kerberos>`. Only required if the service does not use the
   default name of ``mongodb``.
   
   This option is available only in MongoDB Enterprise.
   


.. option:: --gssapiHostName

   .. versionadded:: 2.6
   
   Specify the hostname of a service using :doc:`GSSAPI/Kerberos
   </core/kerberos>`. *Only* required if the hostname of a machine does
   not match the hostname resolved by DNS.
   
   This option is available only in MongoDB Enterprise.
   


.. option:: --dbpath <path>

   Specifies a directory, containing MongoDB data files, to which
   :binary:`~bin.mongooplog` will apply operations from the :term:`oplog` of
   the database specified with the :option:`--from <mongooplog --from>`
   option.
   
   When used, the :option:`--dbpath` option enables :binary:`~bin.mongo` to
   attach directly to local data files and write data without a running
   :binary:`~bin.mongod` instance.
   
   To run with :option:`--dbpath`, :binary:`~bin.mongooplog` needs to restrict
   access to the data directory: as a result, no :binary:`~bin.mongod` can be
   access the same path while the process runs.


.. option:: --directoryperdb

   When used in conjunction with the corresponding option in
   :binary:`~bin.mongod`, allows the :program:`mongooplog` to access data from MongoDB
   instances that use an on-disk format where every database has a distinct
   directory. This option is only relevant when specifying the
   :option:`--dbpath` option.


.. option:: --journal

   Enables the durability :term:`journal` to ensure data files remain valid
   and recoverable. This option applies only when you specify the
   . The :program:`mongooplog` enables journaling by default
   on 64-bit builds of versions after 2.0.


.. option:: --db <database>, -d <database>

   The :option:`--db` option and its alias ``-d`` are inoperative.


.. option:: --collection <collection>, -c <collection>

   The :option:`--collection` option and its alias ``-c`` are inoperative.


.. option:: --seconds <number>, -s <number>

   Specify a number of seconds of operations for :binary:`~bin.mongooplog` to
   pull from the :option:`remote host <mongooplog --from>`. Unless
   specified the default value is ``86400`` seconds, or 24 hours.
   


.. option:: --from <host[:port]>

   Specify the host for :binary:`~bin.mongooplog` to retrieve :term:`oplog`
   operations from. :binary:`~bin.mongooplog` *requires* this option.
   
   Unless you specify the :option:`--host <mongooplog --host>` option,
   :binary:`~bin.mongooplog` will apply the operations collected with this
   option to the oplog of the :binary:`~bin.mongod` instance running on the
   localhost interface connected to port ``27017``.
   


.. option:: --oplogns <namespace>

   Specify a namespace in the :option:`--from <mongooplog --from>` host
   where the oplog resides. The default value is ``local.oplog.rs``, which
   is the where :term:`replica set` members store their operation log.
   However, if you've copied :term:`oplog` entries into another
   database or collection or are pulling oplog entries from a
   :doc:`master-slave </core/master-slave>` deployment, use :option:`--oplogns` to
   apply oplog entries stored in another location. Namespaces take the
   form of ``[database].[collection]``.


Use
---

Consider the following prototype :binary:`~bin.mongooplog` command:

.. code-block:: sh

   mongooplog  --from mongodb0.example.net --host mongodb1.example.net

Here, entries from the :term:`oplog` of the :binary:`~bin.mongod` running
on port ``27017``. This only pull entries from the last 24 hours.

Use the :option:`--seconds <mongooplog --seconds>` argument to capture
a greater or smaller amount of time. Consider the following example:

.. code-block:: sh

   mongooplog  --from mongodb0.example.net --seconds 172800

In this operation, :binary:`~bin.mongooplog` captures 2 full days of
operations. To migrate 12 hours of :term:`oplog` entries, use the
following form:

.. code-block:: sh

   mongooplog  --from mongodb0.example.net --seconds 43200

For the previous two examples, :binary:`~bin.mongooplog` migrates entries
to the :binary:`~bin.mongod` process running on the localhost interface
connected to the ``27017`` port. :binary:`~bin.mongooplog` can also
operate directly on MongoDB's data files if no :binary:`~bin.mongod` is
running on the *target* host. Consider the following example:

.. code-block:: sh

   mongooplog  --from mongodb0.example.net --dbpath /srv/mongodb --journal

Here, :binary:`~bin.mongooplog` imports :term:`oplog` operations from the
:binary:`~bin.mongod` host connected to port ``27017``. This migrates
operations to the MongoDB data files stored in the ``/srv/mongodb``
directory. Additionally :binary:`~bin.mongooplog` will use the durability
:term:`journal` to ensure that the data files remain valid.
